databaseChangeLog:
  - changeSet:
      id: 16-install-btree-gist-extension
      author: db_architect
      changes:
        - sql:

            sql: CREATE EXTENSION IF NOT EXISTS btree_gist;

  - changeSet:
      id: 17-add-exclusion-constraint-to-groups
      author: db_architect
      changes:
        - sql:
            sql: |
              ALTER TABLE groups
              ADD CONSTRAINT groups_room_schedule_overlap_excl
              EXCLUDE USING GIST (
                room_id WITH =,
                schedule WITH =,
                daterange(start_date, end_date, '[]') WITH &&
              )
              WHERE (deleted = false);